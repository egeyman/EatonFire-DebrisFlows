<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Eaton-Fire-Lidar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Latex-like font (Latin Modern or fallback) -->
  <link href="https://fonts.googleapis.com/css2?family=Latin+Modern+Roman&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: 'Latin Modern Roman', 'Times New Roman', serif;
      color: #333;
      line-height: 1.6;
      background: #fff;
      height: 100vh;
      overflow: hidden;
    }

    #map {
      width: 100%;
      height: 100vh;
      position: relative;
      z-index: 1;
    }
    
    /* Sidebar container */
    .sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: 350px;
      height: 100%;
      padding: 20px;
      padding-right: 3em; /* buffer on right side */
      background: #f9f9f9;
      box-shadow: -2px 0 5px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar.collapsed {
      transform: translateX(310px); /* keep 40px visible */
      padding: 0;
    }

    /* Collapse button */
    .collapse-btn {
      position: absolute;
      top: 0;
      right: 0;
      width: 40px;
      height: 100%;
      background: #ddd;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-weight: bold;
      user-select: none;
      border-radius: 6px 0 0 6px;
      z-index: 1100;
    }
    .collapse-btn .triangle {
      display: inline-block;
      margin-left: 5px;
      transform: rotate(270deg);
      transition: transform 0.3s;
    }
    .sidebar.collapsed + .collapse-btn .triangle {
      transform: rotate(90deg);
    }

    h1 {
      font-size: 1.6em;
      margin-top: 0;
    }
    h2 {
      font-size: 1.1em;
      font-weight: 400;
      font-style: italic;
      color: #444;
      margin-top: 0;
      margin-bottom: 1em;
    }
    h3 {
      margin-top: 1.2em;
      font-size: 1.05em;
      color: #222;
    }
    p {
      font-size: 0.95em;
      margin-bottom: 1em;
    }

    .opacity-control {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 6px 10px;
      border-radius: 6px;
      font-family: 'Latin Modern Roman', 'Times New Roman', serif;
      font-size: 13px;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
      z-index: 1500;
    }
    .opacity-control input {
      width: 120px;
    }

    /* Colorbar legend */
    .info.legend {
      background: white;
      padding: 8px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      font-size: 13px;
    }
    .legend-scale {
      display: flex;
      align-items: center;
      flex-direction: row;  /* left-to-right layout */
    }
    .legend-title {
      writing-mode: vertical-rl;
      transform: rotate(180deg); /* makes text read bottom→top */
      text-align: center;
      margin-right: 8px;
      font-weight: bold;
    }
    .colorbar {
      width: 18px;
      height: 150px;
      background: linear-gradient(to top, #ca0020, #f7f7f7, #0571b0); /* subtle RdBu */
      border: 1px solid #999;
    }
    .legend-labels {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 150px;
      margin-left: 6px;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="sidebar" id="sidebar">
    <h1>Topographic changes following the Eaton Fire, Los Angeles</h1>
    <h2>Constraints on post-fire sediment mobilization from repeat airborne lidar.</h2>

    <h3>Contact</h3>
    <p>Emily C. Geyman<br>
    California Institute of Technology<br>
    <a href="mailto:egeyman@caltech.edu">egeyman@caltech.edu</a></p>

    <h3>Motivation and background</h3>
    <p>In early January 2025, the Eaton Fire burned approximately 14,000 acres across the steep hillslopes of the San Gabriel Mountains and the residential communities in Altadena, Pasadena, and Sierra Madre (Los Angeles County). An estimated 23,000 people live in neighborhoods within the burned area. Tens of thousands more live in areas that were not directly burned, but are vulnerable to post-wildfire debris flows. There is need to develop predictive tools to forecast post-wildfire debris flow hazards before they happen.</p>
    <p>Currently, our ability to predict debris flow hazards is stymied by an unanswered question about how these turbulent flows are fueled. Are debris flows sourced from fluid-driven entrainment of hillslope soils, or from the piles of loose sediment that fill channels during wildfire? Here, we differentiate between these two hypotheses through repeat mapping of the burn area with high-resolution lidar.</p>
    <p>By matching lidar-measured erosional volumes in the burned mountain catchments to depositional volumes in the debris basins positioned at the catchment outlets (n = 25), we are able to close the sediment budget of the fire–flood cycle from source to sink. This attribution reveals that debris flows were sourced entirely from the loose sediment that filled the channel networks (as a dry-ravel process) during and immediately following the wildfire.</p>
    <p>This analysis suggests that, in steep and rocky landscapes such as the San Gabriel Mountains, post-fire inventories of sediment loading in channel networks could be used to generate quantitative predictions for debris flow volumes before the destructive debris flows occur.</p>

    <h3>About the map</h3>
    <p>This map allows you to explore the lidar-reconstructed surface elevation changes in the Eaton Fire burn area during two stages: (i) pre-fire to post-fire, and (ii) post-fire to post-storm. Use the layer switcher to toggle datasets, and adjust the slider to change transparency. The gray dots along the mountain front denote the positions of <a href="https://pw.lacounty.gov/core-service-areas/water-resources/sediment/debris-basins/" target="_blank">debris basins</a> (maintained by the Los Angeles Department of Public Works), which catch the slurries of mud, sand, and boulders that are transported out of the mountains as debris flows. The black catchment outlines were adapted from the <a href="https://usgs.maps.arcgis.com/apps/dashboards/c09fa874362e48a9afe79432f2efe6fe" target="_blank">USGS</a> post-wildfire debris flow hazard assessment for the Eaton Fire.</p>


    <h3>Additional details</h3>
<p><b>Survey dates:</b></p>
<ul>
  <li>
    <i>Post-fire, pre-rainstorm:</i> January 21, 2025<br>
    This <a href="https://portal.opentopography.org/raster?opentopoID=OTSDEM.012025.6340.1" target="_blank">survey</a> was sponsored by ALERTCalifornia (UC San Diego) and flown by NV5 Geospatial.
  </li>
  <li>
    <i>Post-rainstorm:</i> February 20, 2025<br>
    This survey was made possible by a rapid-response grant from the National Center for Airborne Laser Mapping (<a href="https://ncalm.cive.uh.edu/ncalm-now" target="_blank">NCALM NOW</a>).
  </li>
</ul>
    <p>The major debris-flow-producing rainstorm occurred on February 13, 2025.</p>
    <p>We estimate that a total of 677,000 cubic meters of sediment was exported out of the burn area and deposited in debris basins during the February 13, 2025 storm event. This volume corresponds to approximately 110,000 single dump truck loads required to clear out the material from the debris basins (<a href="https://pw.lacounty.gov/core-service-areas/uploads/2024/08/Sediment-Strategic-Plan-429.pdf" target="_blank">LACDPW</a>). There still remains an estimated 245,000 cubic meters of loose sediment in the channel network (~40,000 single dump truck loads) that is likely to be mobilized in debris flows during the 2025-2026 rainy season.</p>

    <h3>Access the data</h3>
    <p>The full dataset can be downloaded from Zenodo (<a href="https://doi.org/10.5281/zenodo.15993545" target="_blank">https://doi.org/10.5281/zenodo.15993545</a>).</p>

    <h3>Citation</h3>
    <p>Geyman, E.C., Chen, Z., Lindsay, D.N., DiBiase, R.A., and Lamb, M.P. Post-wildfire debris flows begin dry. <i>In prep.</i> 2025.</p>

 
 <h3>Acknowledgements</h3>
<p>
  Thank you to Pete Robichaud, Jonathan Yonni Schwartz, and Miranda Beasley at the US Forest Service (USFS) for help with field access, field safety, and permitting (USFS Special Use Permit: Authorization ID LAR106004). 
  Thank you to Iraj Nasseri, Ken Zimmer, Dai Bui, Arleth Dayus, and Armando D’Angelo at Los Angeles County Department of Public Works for sharing information about debris basin clean-outs. 
  Computational resources were supported by the Eaton Fire Research Fund (Division of Geological and Planetary Sciences, Caltech). 
  E.C.G. was supported by the National Science Foundation Graduate Research Fellowships Program (GRFP) and the Fannie and John Hertz Foundation. 
  Thank you to Harrison Martin for guidance on making web maps.
</p>
.
    
  </div>

  <!-- Collapse vertical bar -->
  <div class="collapse-btn" id="collapseBtn">Data source & details   <span class="triangle"> ▼ </span></div>

  <!-- Opacity slider -->
  <div class="opacity-control">
    <label for="opacityRange">Overlay opacity:</label><br>
    <input type="range" id="opacityRange" min="0" max="100" value="100">
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    var map = L.map('map', { zoomControl: true, attributionControl: true });

    var googleSat = L.tileLayer(
      'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
      {
        maxZoom: 20,
        subdomains: ['mt0','mt1','mt2','mt3'],
        attribution: '&copy; <a href="https://www.google.com/earth/">Google</a>'
      }
    ).addTo(map);

    // Hillshade layer (initially OFF, below lidar)
    var hillshade = L.tileLayer('hillshade/{z}/{x}/{y}.png', {
      minZoom: 0, maxZoom: 20, maxNativeZoom: 18, opacity: 1,
      attribution: '© Hillshade'
    });

    var lidarCB = L.tileLayer('lidar_dz_CB/{z}/{x}/{y}.png', {
      minZoom: 0, maxZoom: 20, maxNativeZoom: 17, opacity: 1,
      attribution: '© Emily Geyman'
    }).addTo(map);

    var lidarBA = L.tileLayer('lidar_dz_BA/{z}/{x}/{y}.png', {
      minZoom: 0, maxZoom: 20, maxNativeZoom: 17, opacity: 1,
      attribution: '© Emily Geyman'
    });

    // Ensure lidar layers are always on top of hillshade
    lidarBA.on('add', function() { lidarBA.bringToFront(); });
    lidarCB.on('add', function() { lidarCB.bringToFront(); });

    var overlays = {
      "Pre-fire to post-fire": lidarBA,
      "Post-fire to post-storm": lidarCB,
      "Hillshade only": hillshade
    };

    var baseMaps = { "Google Satellite": googleSat };
    L.control.layers(baseMaps, overlays, { collapsed: false, position: 'topleft' }).addTo(map);

    // EPSG:3857 bounds (xmin, ymin, xmax, ymax)
    var xmin = -13154725.5859,
        ymin = 4049146.1307,
        xmax = -13129637.2445,
        ymax = 4065167.0671;

    // Convert back to lat/lon (EPSG:4326)
    var southWest = L.CRS.EPSG3857.unproject(L.point(xmin, ymin));
    var northEast = L.CRS.EPSG3857.unproject(L.point(xmax, ymax));
    var bounds = L.latLngBounds(southWest, northEast);
    map.fitBounds(bounds);

    // Opacity control
    var activeOverlay = lidarCB;
    document.getElementById('opacityRange').value = Math.round(activeOverlay.options.opacity*100);

    document.getElementById('opacityRange').addEventListener('input', function() {
      if (activeOverlay) {
        var val = this.value / 100;
        activeOverlay.setOpacity(val);
      }
    });

    map.on('overlayadd', function(e) {
      activeOverlay = e.layer;
      document.getElementById('opacityRange').value = Math.round((activeOverlay.options.opacity || 1)*100);
      if (e.layer === lidarBA) lidarBA.bringToFront();
      if (e.layer === lidarCB) lidarCB.bringToFront();
    });

    map.on('overlayremove', function(e) {
      if (activeOverlay === e.layer) activeOverlay = null;
    });

    // Sidebar collapse
    const sidebar = document.getElementById('sidebar');
    const collapseBtn = document.getElementById('collapseBtn');
    collapseBtn.addEventListener('click', function() {
      sidebar.classList.toggle('collapsed');
    });

    // === Add colorbar legend ===
    var colorbar = L.control({position: 'topleft'});
    colorbar.onAdd = function (map) {
      var div = L.DomUtil.create('div', 'info legend');
      div.innerHTML =
        '<div class="legend-scale">' +
          '<div class="legend-title">Surface elevation change [m]</div>' +
          '<div class="colorbar"></div>' +
          '<div class="legend-labels">' +
            '<div>+3</div>' +
            '<div>0</div>' +
            '<div>-3</div>' +
          '</div>' +
        '</div>';
      return div;
    };
    colorbar.addTo(map);
  </script>
</body>
</html>



